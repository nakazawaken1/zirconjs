<meta charset="UTF-8" />
<title>test</title>
<main>
  <textarea id="test">
{
  "0": 0,
  " 1": 1,
  "  2": 2,
  "3 ": 3,
  "  4  ": 4,
  "123456789": 123456789,
  "+1": 1,
  "- 2": -2,
  " +3 ": 3,
  "1+2": 3,
  "3 + 4": 7,
  " 5 - 6 ": -1,
  "1 + 2 + 3": 6,
  "1 + 2 * 3": 7,
  "-1 - 2": -3,
  "-3--4": 1,
  "1 - - 2": 3,
  "": "シンボルが見つかりません(1文字目 \\\\\\\\\\)",
  "a": "aは定義されていません",
  "+": "シンボルが見つかりません(2文字目 \\+\\\\\\)",
  "++3": 3,
  "1+": "シンボルが見つかりません(3文字目 1+\\\\\\)",
  "1 2": 2,
  "1 / 2": 0.5,
  "2 / 2": 1,
  "3 / 0": "0で除算できません",
  "1 % 2": 1,
  "2 % 2": 0,
  "3 % 0": "0で除算できません",
  "? 1": 1,
  "? 2 ? 3": 3,
  "a : 1 + 2 ? a + a": 6,
  "pow: do n { n * n } pow(3)": 9,
  "4 ^ 3 ^ 2": 262144,
  "add_double: do a, b { (a + b) * 2 } add_double(1, 2)": 6,
  "if 1 { ? 1 }": 1,
  "if 0 { ? 0 }": null,
  "if true { ? true }": true,
  "if false { ? false }": null,
  "if true { ? 1 } ef true { ? 2 } else { ? 3 }": 1,
  "if false { ? 1 } ef true { ? 2 } else { ? 3 }": 2,
  "if false { ? 1 } ef false { ? 2 } else { ? 3 }": 3,
  "if 1 < 2 { 1 } else { 2 }": 1,
  "if 1 < 1 { 1 } else { 2 }": 2,
  "if 1 <= 2 { 1 } else { 2 }": 1,
  "if 1 <= 1 { 1 } else { 2 }": 1,
  "if 1 > 2 { 1 } else { 2 }": 2,
  "if 1 > 1 { 1 } else { 2 }": 2,
  "if 1 >= 2 { 1 } else { 2 }": 2,
  "if 1 >= 1 { 1 } else { 2 }": 1,
  "if 1 = 2 { 1 } else { 2 }": 2,
  "if 1 = 1 { 1 } else { 2 }": 1,
  "if 1 <> 2 { 1 } else { 2 }": 1,
  "if 1 <> 1 { 1 } else { 2 }": 2,
  "if 1 < 2 and 3 < 4 { true } else { false }": true,
  "if 1 < 2 and 3 < 3 { true } else { false }": false,
  "if 1 < 1 and 3 < 4 { true } else { false }": false,
  "if 1 < 1 and 3 < 3 { true } else { false }": false,
  "if 1 < 2 or 3 < 4 { true } else { false }": true,
  "if 1 < 2 or 3 < 3 { true } else { false }": true,
  "if 1 < 1 or 3 < 4 { true } else { false }": true,
  "if 1 < 1 or 3 < 3 { true } else { false }": false,
  "if not 1 < 2 { true } else { false }": false,
  "if not 1 < 1 { true } else { false }": true,
  "addN: do n { do m { n + m } } add3: addN(3) add3(1)": 4,
  "(1, 2, 3).0": 1,
  "(1, 2, 3).1": 2,
  "(1, 2, 3).2": 3,
  "(1, 2, 3).4": null,
  "(1, 2, 3).(-1)": 3
}
</textarea>
  <button type="button">テスト<br>実行</button>
  <section>
    <nav></nav>
    <ul>
      <li><code>ソース</code><code>期待結果</code><code>実行結果</code><code>判定</code></li>
    </ul>
    <ol id="results">
    </ol>
  </section>
</main>

<style>
  main {
    display: grid;
    grid-template-columns: 1fr max-content 1fr;
  }

  textarea {
    width: 100%;
    height: 90vh;
  }

  ul {
    text-align: center;
  }

  ul, ol {
    margin: 0;
  }

  code, label {
    border: 1px solid silver;
    padding: 0.25em 0.5em;
  }

  nav,
  label {
    text-align: center;
  }

  li {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
  }
</style>

<script type="module">
  import zircon from './zircon.mjs'
  const test = document.querySelector("#test")
  const results = document.querySelector("#results")
  const nav = document.querySelector("nav")
  document.querySelector("button").addEventListener("click", e => {
    results.innerHTML = ""
    nav.innerHTML = ""
    const corrects = Object.entries(JSON.parse(test.value)).map(([source, expect]) => {
      let result
      try {
        const ast = zircon.parse(source)
        console.log(JSON.stringify(ast))
        result = zircon.run(ast, { out() { } })
      } catch (e) {
        result = e
      }
      const correct = result == expect
      const li = document.createElement("li")
      li.innerHTML = `<code>${source}</code><code>${expect}</code><code>${result}</code><label>${correct ? "✅" : "🆖"}</label>`
      results.appendChild(li)
      return correct
    })
    nav.innerHTML = `テスト数：${corrects.length} 通過：${corrects.filter(i => i).length} 失敗：${corrects.filter(i => !i).length}`
  })
</script>